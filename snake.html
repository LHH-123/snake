<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>贪吃蛇</title>
<style type="text/css">
	body{background-image:url(back.jpg);}
   #wrap{width:700px;margin:0 auto;}
   table{border-spacing: 0px;border:1px solid gray;}
   td{width:14px;height:14px;border:1px solid #336699;box-sizing:border-box;}
</style>
</head>
<body>
<div id="wrap-all">
<div id="wrap"></div>	
</div>
<script type="text/javascript">

function Snake(x, y, length,dir)
{
	this.length = length;
	this.dir = dir;
	this.snakeBody = new Array(length);
	for (i = 0;i < length; i++)
	{
		this.snakeBody[i] = new Array(2);
	}
	this.snakeBody[0][0] = x;
	this.snakeBody[0][1] = y;
}

Snake.prototype = 
{
	initSnake:function()
	{
		for(var i=0; i<this.length; i++)
	    {
		    this.snakeBody[i][0] = this.length-1-i;
		    this.snakeBody[i][1] = 0;
	    }

	},
	move:function()
	{
		for (var i = this.length-1; i >=1; i--) 
		{
			this.snakeBody[i][0] = this.snakeBody[i-1][0];
	        this.snakeBody[i][1] = this.snakeBody[i-1][1];
		}
		if (this.dir == "left")
	    {
		    this.snakeBody[0][0] -= 1;
	    }
	    else if (this.dir == "right")	    	
	    {
		    this.snakeBody[0][0] += 1;
	    }
	    else if (this.dir == "up")
	    {
		    this.snakeBody[0][1] -= 1;
	    }
	    else if (this.dir == "down")
	    {
		    this.snakeBody[0][1] += 1;		
	    }		
	},

}

function Map(width, height)
{
	this.width = width;
	this.height = height;
	this.mapArr = new Array(this.width);
	for (var i = 0; i < this.width; i++)
	{
		this.mapArr[i] = new Array(this.height);
	};
}
Map.prototype =
{
	chessBord: function(id)
	{
		var getWrap = document.getElementById(id);
        var tBody = document.createElement('tbody')
		for (var i = 0; i < this.width; i++) 
	    {
		     var col = document.createElement("tr");
		for (var j = 0; j < this.height; j++) 
		{
			var row = document.createElement("td");
			this.mapArr[j][i] = col.appendChild(row);	
		};
		tBody.appendChild(col);
	    };
	    var tTable=document.createElement('table');
	    tTable.appendChild(tBody);
	    getWrap.appendChild(tTable);	    
	},
	drawSnake: function(snake)
	{
		for (var i =0; i < snake.length; i++)
	    {
		    this.mapArr[snake.snakeBody[i][0]][snake.snakeBody[i][1]].style.backgroundColor = 'yellow';
	    }
	},
	drawFood:function(food)
	{
		for (var i = 0; i < food.num; i++) 
		{
			this.mapArr[food.foodArr[i][0]][food.foodArr[i][1]].style.backgroundColor = 'red';
		};

	},
	clearMap: function()
	{
		for (var i = 0; i < this.width; i++) 
	    {
		    for (var j = 0; j < this.height;j++) 
		    {	
			    this.mapArr[i][j].style.backgroundColor = '#003366';
		    }
	    }
	}
}

function Food(num)
{
	this.num = num;
	this.foodArr = new Array(num);
	for (var i = 0; i < num; i++)
	{
		this.foodArr[i] = new Array(2);
	};

}
Food.prototype = 
{
	initFood:function(x,y)
	{
		for (var i = 0; i < this.num; i++) 
	    {
		    this.foodArr[i][0] = Math.floor(Math.random()*x);
		    this.foodArr[i][1] = Math.floor(Math.random()*y);	
	    }; 
	}
}

function GameMgr()
{
	this.snake = new Snake(0,0,5,"right");
	this.map =  new Map(50,50);
	this.food = new Food(10);
	this.initGameMgr.apply(this,arguments);
	this.score = 0;
}
GameMgr.prototype = 
{
	initGameMgr:function()
	{
		this.snake.initSnake();

		this.map.chessBord('wrap');
		this.map.drawSnake(this.snake);
		

		this.food.initFood(this.map.width,this.map.height);
		this.map.drawFood(this.food);

		var that = this;

		this.addEvent(window, 'keydown', function()
		{ 
			that.snake.dir = that.getDir(event,that.snake.dir);
			//将事件监听器处理结果返回到snake中
		});
		var timmer = setInterval(function()
		{
            that.map.clearMap();
            that.collision(that.snake,that.food,that.map,timmer);
            that.snake.move(that.snake.dir);

            that.map.drawSnake(that.snake);  
            that.map.drawFood(that.food); 
        },300);
	},
	collision:function(snake,food,map,timmer)
	{
		for (var i = 0; i < this.food.num; i++) 
		{
			if (this.snake.snakeBody[0][0] == this.food.foodArr[i][0] 
				&& this.snake.snakeBody[0][1] == this.food.foodArr[i][1]) 
		    {		        	
		        this.snake.length++;
		        this.food.num--;
		        this.score += 10;
		        this.snake.snakeBody.push([this.food.foodArr[i][0], this.food.foodArr[i][1]]);
		        this.food.foodArr.splice(i,1);
		        return;
		    }
		}

		if (this.snake.snakeBody[0][0]<0 
			||this.snake.snakeBody[0][0]>map.width 
			|| this.snake.snakeBody[0][1]<0 
			||this.snake.snakeBody[0][1]>map.height)
		{
			clearInterval(timmer);
			alert(this.score + "分,"+"哥们儿，你屎啦");
			return;
		} 

		for (var i = 1; i < this.snake.snakeBody.length; i++) 
		{
			if (this.snake.snakeBody[0][0] == this.snake.snakeBody[i][0] 
				&& this.snake.snakeBody[0][1] == this.snake.snakeBody[i][1]) 
			{
				clearInterval(timmer);
				alert(this.score + "分,"+"哥们儿，你撞到自己啦");
		        return;
			}
			
		}
/*		if(this.food.num == 1)
		{
			this.food.num = 10;
			alert(this.food.foodArr.length);
			this.food.initFood(this.map.width,this.map.height);
		}	*/    		
		
	},
	getDir:function(event,dir)
    {
	    var keyCode = event.keyCode ||event.which;
	    switch(keyCode)
	    {
		    case 37: 
		    if(dir != "right") dir = "left";
		    return dir;
		    case 38: 
		    if(dir != "down" ) dir = "up";
		    return dir;
		    case 39:
		    if(dir != "left" ) dir = "right";
		    return dir;
		    case 40: 
		    if(dir != "up" )  dir = "down";
		    return dir;
	    }
    },
    addEvent:function(ele,type,handler)
    {
	    return ele.addEventListener ? ele.addEventListener(type,handler, false) : ele.attachEvent('on'+type, handler);
    }

}

window.onload = function()
{
    new GameMgr();
}

</script>	
</body>
</html>